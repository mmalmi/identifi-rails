<%
  signedData = message["data"]["signedData"] 

  rating = signedData["rating"]
  neutralRating = (signedData["minRating"] + signedData["maxRating"]) / 2
  reviewToneStyle = "panel-warning"
  iconStyle = "glyphicon-question-sign"
  if rating > neutralRating
    reviewToneStyle = "panel-success"
    iconStyle = "glyphicon-thumbs-up"
  elsif rating < neutralRating
    reviewToneStyle = "panel-danger"
    iconStyle = "glyphicon-thumbs-down"
  end

  author = signedData["author"].find { |a| a.first == "nickname" || a.first == "name" }
  recipient = signedData["recipient"].find { |r| r.first == "nickname" || r.first == "name" }
  author = signedData["author"].first if author.nil?
  recipient =  signedData["recipient"].first if recipient.nil?
%>

<div class="panel <%= reviewToneStyle %>">
  <div class="panel-heading">
    <p>
      <span class="glyphicon <%= iconStyle %> pull-right"></span>
      <% if showAuthor %>
      <strong>
        <a href="/id/<%= author.first %>/<%= author.last %>">
          <%= author.second %>
        </a>
      </strong>
      <% end %>
      &#x25B8;
      <% if showRecipient %>
      <a href="/id/<%= recipient.first %>/<%= recipient.last %>">
        <%= recipient.second %>
      </a>
      <% end %>
    </p>
    <p><%= signedData["comment"] %></p>
    <p><a href="/message/<%= message["hash"] %>" class="text-muted"><%= Time.at(signedData["timestamp"]).to_time %></a></p>
  </div>
</div>